<div class="explore">
	<div class="domains">
		<mat-tab-group
			animationDuration="0"
			(selectedTabChange)="onTabChange($event)"
		>
			<mat-tab
				*ngFor="
					let tab of [
						{
							name: 'Popular',
							icon: 'public',
							tab: tabs.popular
						},
						{
							name: 'Liked',
							icon: 'favorite',
							tab: tabs.liked
						},
						{
							name: 'Private',
							icon: 'lock',
							tab: tabs.private
						}
					]
				"
				[attr.data-tab-key]="tab.tab.key"
			>
				<ng-template mat-tab-label>
					<mat-icon style="margin-right: 8px;">{{
						tab.icon
					}}</mat-icon>
					{{ tab.name }}
				</ng-template>
				<mat-progress-bar
					mode="indeterminate"
					[style.opacity]="loading ? '1' : '0'"
					style="margin-bottom: -4px; transition: opacity 200ms;"
				></mat-progress-bar>
				<div
					class="domain-list"
					infiniteScroll
					[scrollWindow]="false"
					(scrolled)="fetchDomains(tab.tab, false)"
				>
					<ng-container *ngFor="let domain of tab.tab.domains">
						<app-domain-card [domain]="domain"></app-domain-card>
					</ng-container>
				</div>
			</mat-tab>
		</mat-tab-group>
		<div class="domain-buttons">
			<button
				mat-stroked-button
				style="margin-right: 8px;"
				(click)="onVisitTutorialWorld()"
			>
				Visit tutorial world
			</button>
			<mat-form-field appearance="outline">
				<mat-icon matPrefix>search</mat-icon>
				<mat-label>Search</mat-label>
				<input matInput type="text" (keyup)="onSearch($event)" />
			</mat-form-field>
			<button
				mat-button
				class="icon-button"
				[disabled]="!canGoBack"
				(click)="goBack()"
			>
				<mat-icon>arrow_back</mat-icon>
			</button>
			<button
				mat-button
				class="icon-button"
				[disabled]="!canGoForward"
				(click)="goForward()"
			>
				<mat-icon>arrow_forward</mat-icon>
			</button>
			<button mat-button class="icon-button" (click)="refresh()">
				<mat-icon>refresh</mat-icon>
			</button>
		</div>
		<div class="current-domain" *ngIf="currentDomain">
			<div
				class="thumbnail"
				[ngStyle]="{
					backgroundImage:
						'url(' +
						scriptService.metaverseUrl +
						'/api/domain/' +
						currentDomain.id +
						'/image)'
				}"
			></div>
			<div class="name">
				<p style="font-weight: 500;">
					{{ currentDomain.label }}
					<span class="subtitle">{{ currentDomain.username }}</span>
				</p>
				<p style="font-size: 0.8em;">
					{{ currentDomain.description }}
				</p>
			</div>
			<div class="people">
				<p style="font-weight: 500;">
					{{
						currentDomain.online
							? displayPlural(
									currentDomainUserCount,
									"person",
									"people"
							  )
							: "Offline"
					}}
				</p>
				<p style="font-size: 0.8em;">
					{{ currentDomain.online ? "currently here" : "" }}
				</p>
			</div>
			<div class="people">
				<p style="font-weight: 500;">
					{{
						currentDomain.online
							? displayPlural(
									getFriendsInCurrentDomain().length,
									"friend"
							  )
							: ""
					}}
				</p>
				<p style="font-size: 0.8em;">
					{{ currentDomain.online ? "currently here" : "" }}
				</p>
			</div>
			<div style="flex-grow: 1;"></div>
			<div class="buttons">
				<button
					mat-flat-button
					class="like-button"
					[class.active]="currentDomain.liked"
					(click)="onLikeCurrentDomain()"
				>
					{{ currentDomain.likes }}
					<mat-icon *ngIf="!currentDomain.liked">
						favorite_border
					</mat-icon>
					<mat-icon *ngIf="currentDomain.liked">favorite</mat-icon>
				</button>
			</div>
		</div>
	</div>
	<div class="friends">
		<h2 style="margin-top: 0; margin-bottom: 12px;">
			<mat-icon inline>supervisor_account</mat-icon> Online Users
		</h2>

		<div class="domain-friends" *ngFor="let domain of domainFriends">
			<h3>
				<mat-icon inline *ngIf="domain.private">lock</mat-icon>
				{{ domain.name }}
			</h3>
			<div
				class="friend"
				*ngFor="let friend of domain.friends"
				(click)="onJoinFriend(friend.username)"
			>
				<!-- <div
					class="avatar"
					[style.backgroundImage]="'url(' + friend.image + ')'"
				>
					<div class="status"></div>
				</div> -->
				<svg class="avatar" viewBox="0 0 32 32">
					<mask
						id="avatar-mask"
						maskContentUnits="objectBoundingBox"
						viewBox="0 0 1 1"
					>
						<circle fill="white" cx="0.5" cy="0.5" r="0.5"></circle>
						<circle
							fill="black"
							cx="0.84375"
							cy="0.84375"
							r="0.25"
						></circle>
					</mask>
					<image
						mask="url(#avatar-mask)"
						[attr.href]="friend.image"
						height="32"
						width="32"
					/>
					<circle
						fill="rgb(67, 181, 129)"
						cx="27"
						cy="27"
						r="5"
					></circle>
				</svg>
				<div class="info">
					<p class="name">{{ friend.username }}</p>
					<!-- <p class="location">{{ friend.domain.name }}</p> -->
				</div>
			</div>
		</div>
	</div>
</div>
