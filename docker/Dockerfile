FROM ubuntu:18.04

ENV HIFI_DOMAIN_SERVER_HTTP_PORT=40100
ENV HIFI_DOMAIN_SERVER_HTTPS_PORT=40101
ENV HIFI_DOMAIN_SERVER_PORT=40102
ENV HIFI_DOMAIN_SERVER_DTLS_PORT=40103

ENV HIFI_ASSIGNMENT_CLIENT_AUDIO_MIXER_PORT=48000
ENV HIFI_ASSIGNMENT_CLIENT_AVATAR_MIXER_PORT=48001
ENV HIFI_ASSIGNMENT_CLIENT_ASSET_SERVER_PORT=48003
ENV HIFI_ASSIGNMENT_CLIENT_MESSAGES_MIXER_PORT=48004
ENV HIFI_ASSIGNMENT_CLIENT_ENTITY_SCRIPT_SERVER_PORT=48005
ENV HIFI_ASSIGNMENT_CLIENT_ENTITIES_SERVER_PORT=48006

ENV LD_LIBRARY_PATH=/root/lib

RUN apt update -y && apt install -y python3 supervisor curl

COPY dist/. /root
COPY supervisor.conf /etc/supervisor/conf.d/tivoli.conf

CMD python3 /root/modify-domain-port.py && /usr/bin/supervisord -c /etc/supervisor/conf.d/tivoli.conf
